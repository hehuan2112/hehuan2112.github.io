<!doctype html>
<html>
<head>
<title>Huan He</title>
<base target="_blank">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta name="HandheldFriendly" content="True" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="author" content="Huan He" />
<meta name="description" content="A personal website for showing what I have done" />

<!-- icon -->
<link rel="shortcut icon" href="{{ page_name | pg2path }}/{{ THEME_STATIC_DIR }}/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="{{ page_name | pg2path }}/{{ THEME_STATIC_DIR }}/img/favicon.ico" type="image/x-icon">

<!-- css -->
<link rel="stylesheet" href="{{ page_name | pg2path }}/{{ THEME_STATIC_DIR }}/css/milligram.min.css">
<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto Mono"> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
<style>
body {
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    overflow: hidden;
}
.button, button {
  height: 2em;
}
.wrapper {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    position: absolute;
    top: 0;
    left: 0;
}
.container {
    padding-top: 8px;
    padding-bottom: 8px;
}
.text-xlarge {
  font-size: 1.8em;
}
.text-smaller {
  font-size: smaller;
}
.text-news {
  font-size: smaller;
}
.news-date {
  font-family: 'Courier New', Courier, monospace;
}
.col-date {
  text-align: right;
}
.publication, .project {
  margin-bottom: .5em;
}
.publication img, .project img, .patent img {
  margin: 4px 0 0 0;
  padding: 5px;
  border: 1px solid lightgray;
}
.publication .pub-content {
  padding-top: 1px;
}
.pub-year {
  border-bottom: 1px solid #cfcfcf;
}
.tag-link {
  font-size: .75em;
  padding: 3px 5px;
  border-radius: 3px;
  text-decoration: none;
}
.tag-link-cite {
  color: gray;
}
.tag-link-cite:hover {
  color: blue;
}
.tag-link-paper {
  color: gray;
}
.tag-link-paper:hover {
  background: rgb(255, 145, 145);
  color: white;
}
.tag-link-web {
  color: gray;
}
.tag-link-web:hover {
  background: rgb(4, 69, 155);
  color: white;
}
.tag-link-demo {
  color: gray;
}
.tag-link-demo:hover {
  background: rgb(4, 155, 104);
  color: white;
}
.tag-link-video {
  color: gray;
}
.tag-link-video:hover {
  background: rgb(0, 153, 255);
  color: white;
}
.tag-link-ppt {
  color: gray;
}
.tag-link-ppt:hover {
  background: rgb(255, 153, 0);
  color: white;  
}
.tag-link-poster {
  color: gray;
}
.tag-link-poster:hover {
  background: rgb(248, 88, 7);
  color: white;  
}
.tag-link-pmid {
  color: #0071bc;
}
.tag-link-pmid:hover {
  color: white;
  background-color: #1068a2;
}
.tag-link-doi {
  color: grey;
}
.tag-link-doi:hover {
  background: grey;
  color: white;  
}
.tag-link-hover-show {
  display: none;
}
.pub-content:hover .tag-link-hover-show {
  display: inline;
}

/* plugin for milligram.css */
.row .column.column-18 {
    flex: 0 0 18%;
    max-width: 18%;
}
.row .column.column-82 {
    flex: 0 0 82%;
    max-width: 82%;
}

/* navigation */
.navigation {
  width: 100%;
  position: sticky;
  background-color: white;
  top: 0;
}
.navigation ul {
  list-style: none;
}
.navigation li {
  display: inline-block;
}
.navigation li a {
  color: #606060;
  display: block;
  font-size: 14px;
  padding: 1em;
  cursor: pointer;
  /* font-family: 'Roboto Mono', Courier, monospace; */
}
.navigation li a:hover {
  color: black;
  border-bottom: 2px solid #a7a7a7;
  /* font-weight: bold; */
}
.navigation li.active a:hover {
  border-bottom: 0;
}
.navigation li.active {
  border-bottom: 2px solid #464646;
}
.navigation li.active a {
  color: black;
  font-weight: bold;
}
.section-header {
  margin-top: 2em;
  margin-bottom: 1em;
}
.navbar-toggler {
    display: none;
    z-index: 9;
    position: absolute;
    top: 5px;
    right: 5px;
    width: 57px;
    height: 42px;
    padding: 5px 0;
    background-color: white;
    border-radius: 8px;
    border: 1px solid #999999;
    text-align: center;
}
.navbar-toggler-icon {
    display: inline-block;
    width: 30px;
    height: 30px;
    vertical-align: middle;
    background-repeat: no-repeat;
    background-position: center;
    background-size: 100%;
    background-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke='rgb(42,42,42)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg>");
}
.navbar {
    display: none;
    z-index: 5;
    position: sticky;
    top: 0px;
    background: white;
    cursor: pointer;
    padding-top: 1em;
}
.back-to-top {
    display: none;
    position: absolute;
    bottom: 10px;
    right: 10px;
    width: 40px;
    height: 40px;
    background-color: white;
    border-radius: 8px;
    border: 1px solid #999999;
    text-align: center;
    z-index: 5;
    cursor: pointer;
}
.back-to-top:hover {
    background-color: #d9f1ff;
}
.display-block {
    display: block !important;
}

/* for dialog */
/**************************\
  Basic Modal Styles
\**************************/

.modal {
  font-family: -apple-system,BlinkMacSystemFont,avenir next,avenir,helvetica neue,helvetica,ubuntu,roboto,noto,segoe ui,arial,sans-serif;
}

.modal__overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
}

.modal__container {
  background-color: #fff;
  padding: 10px;
  max-width: 500px;
  max-height: 100vh;
  border-radius: 4px;
  overflow-y: auto;
  box-sizing: border-box;
}

.modal__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal__title {
  margin-top: 0;
  margin-bottom: 0;
  font-weight: 600;
  font-size: 1.25rem;
  line-height: 1.25;
  color: #00449e;
  box-sizing: border-box;
}

.modal__close {
  background: transparent;
  border: 0;
}

.modal__header .modal__close:before { content: "\2715"; }

.modal__content {
  margin-top: 1rem;
  margin-bottom: 1rem;
  line-height: 1.5;
  color: rgba(0,0,0,.8);
}

.modal__btn {
  font-size: .875rem;
  padding-left: 1rem;
  padding-right: 1rem;
  padding-top: .5rem;
  padding-bottom: .5rem;
  background-color: #e6e6e6;
  color: rgba(0,0,0,.8);
  border-radius: .25rem;
  border-style: none;
  border-width: 0;
  cursor: pointer;
  text-transform: none;
  overflow: visible;
  line-height: 1.15;
  margin: 0;
}

.modal__btn-primary {
  background-color: #00449e;
  color: #fff;
}



/**************************\
  Demo Animation Style
\**************************/
@keyframes mmfadeIn {
    from { opacity: 0; }
      to { opacity: 1; }
}

@keyframes mmfadeOut {
    from { opacity: 1; }
      to { opacity: 0; }
}

@keyframes mmslideIn {
  from { transform: translateY(15%); }
    to { transform: translateY(0); }
}

@keyframes mmslideOut {
    from { transform: translateY(0); }
    to { transform: translateY(-10%); }
}

.micromodal-slide {
  display: none;
}

.micromodal-slide.is-open {
  display: block;
}

.micromodal-slide[aria-hidden="false"] .modal__overlay {
  animation: mmfadeIn .3s cubic-bezier(0.0, 0.0, 0.2, 1);
}

.micromodal-slide[aria-hidden="false"] .modal__container {
  animation: mmslideIn .3s cubic-bezier(0, 0, .2, 1);
}

.micromodal-slide[aria-hidden="true"] .modal__overlay {
  animation: mmfadeOut .3s cubic-bezier(0.0, 0.0, 0.2, 1);
}

.micromodal-slide[aria-hidden="true"] .modal__container {
  animation: mmslideOut .3s cubic-bezier(0, 0, .2, 1);
}

.micromodal-slide .modal__container,
.micromodal-slide .modal__overlay {
  will-change: transform;
}

.citation-text {
  padding: 5px;
}

/* for mobile devices */
@media (max-width: 720px) {
    .navbar-toggler {
        display: block;
    }
    .navigation {
        display: none;
    }
    .navbar ul {
        list-style: none;
    }
    .navbar li {
      display: block;
      padding: 0.2em 0;
    }
    .navbar li a {
        display: block;
        width: 100%;
        font-size: 14px;
        padding: 0.2em 1em;
        cursor: pointer;
        color: #333333;
        /* font-family: 'Roboto Mono', Courier, monospace; */
        border-bottom: 1px solid #efefef;
    }

    .back-to-top {
        display: block;
    }
    h2 {
        margin-top: 1.5em;
    }
    .row {
        display: flex;
        flex-direction: column;
    }
    .row .column.column-18 {
        flex: 0 0 100%;
        max-width: 100%;
    }
    .row .column.column-82 {
        flex: 0 0 100%;
        max-width: 100%;
    }
    .row .column.column-20 {
        flex: 0 0 100%;
        max-width: 100%;
    }
    .row .column.column-80 {
        flex: 0 0 100%;
        max-width: 100%;
    }
    .row .column.column-25 {
        flex: 0 0 100%;
        max-width: 100%;
    }
    #info {
        text-align: center;
    }
    #left img {
        width: 60%;
    }
    #left p {
        width: 100%;
    }
    #left .text-news {
        float: left;
    }
    #left {
        width: 100%;
        clear: both;
    }
    #right {
        width: 100%;
        clear: both;
    }
    /* images */
    .publication img, .project img, .patent img {
        width: 62%;
        margin: 0 auto;
        margin-top: 1em;
    }
    .publication, .project {
        margin-bottom: 1.5em;
    }
    .col-date {
        text-align: center;
    }
    .pub-image, .tool-image {
        text-align: center;
    }
    .work-date {
        text-align: center;
        margin-top: 1em;
    }
  
}
</style>
</head>
<body>

<div class="navbar-toggler"
    onclick="toggleNavbar()">
    <span class="navbar-toggler-icon"></span>
</div>

<div class="navbar"></div>

<div class="back-to-top"
    onclick="backToTop()"
    title="Back to Page Top">
    <svg xmlns="http://www.w3.org/2000/svg"
        width="32px"
        height="32px"
        viewBox="0 0 32 32">
        <polygon points="16,14 6,24 7.4,25.4 16,16.8 24.6,25.4 26,24 "/>
        <rect x="4" y="8" width="24" height="2"/>
    </svg>
</div>


<div class="wrapper">

<div class="container">
  <div id="main-row" class="row">
    <div id="left" class="column column-18">
      <div id="info">
        <img src="{{ page_name | pg2path }}/{{ THEME_STATIC_DIR }}/img/me2.jpg">
        <p>
          <span class="text-xlarge">Huan He</span><br>
          {{ WORKS['me']['email'] }}
          <br>
          <span class="text-smaller">
            {{ WORKS['me']['institution'] }}
          <br>
            {{ WORKS['me']['address'] }}
          </span>
          <!-- 
          <span class="text-wish">
            A large office, good pay, and very little work.
            Frequent expense-account trips to exotic lands would be a plus.
          </span> 
          -->
        </p>
      </div>
      <hr>

      <h4 id="news">
        NEWS
      </h4>
      {% for p in WORKS['news'] %}
      {% if p['date'] != '' and p['text'] != '' %}
      <div class="text-news">
        {{ (p['date'] + ": " + p['text'])|md2html }}
      </div>
      {% endif %}
      {% endfor %}

    </div>




    <div id="right" class="column column-82">

      <!-- About me -->

      {{ WORKS['me']['about']|md2html }}
      <p></p>


      <span id="publications"
        class="section-header"></span>

      <div class="navigation">
        <ul class="nav-list">
          <li class="nav-item">
            <a target="_self" onclick="onClickNav(this)" href="#news">
              <i class="bi bi-newspaper"></i>
              News
            </a>
          </li>
          <li class="nav-item active">
            <a target="_self" onclick="onClickNav(this)" href="#publications">
              <i class="bi bi-journal-richtext"></i>
              Publications
            </a>
          </li>
          <li class="nav-item">
            <a target="_self" onclick="onClickNav(this)" href="#projects">
              <i class="bi bi-journal-code"></i>
              Projects
            </a>
          </li>
          <li class="nav-item">
            <a target="_self" onclick="onClickNav(this)" href="#tools">
              <i class="bi bi-tools"></i>
              Tools
            </a>
          </li>
          <li class="nav-item">
            <a target="_self" onclick="onClickNav(this)" href="#patents">
              <i class="bi bi-file-lock"></i>
              Patents
            </a>
          </li>
          <li class="nav-item">
            <a target="_self" onclick="onClickNav(this)" href="#work_exp">
              <i class="bi bi-buildings"></i>
              Work Experience
            </a>
          </li>
          <li class="nav-item">
            <a target="_self" onclick="onClickNav(this)" href="#community_services">
              <i class="bi bi-people"></i>
              Community Services
            </a>
          </li>
          <li class="nav-item">
            <a target="_self" onclick="onClickNav(this)" href="#awards">
              <i class="bi bi-award"></i>
              Awards
            </a>
          </li>
          <li class="nav-item">
            <a target="_self" 
              href="{{ page_name | pg2path }}/page/album.html">
              <i class="bi bi-images"></i>
              Album
            </a>
          </li>
          <li class="nav-item">
            <a target="_self" 
              href="{{ page_name | pg2path }}/page/blog.html">
              <i class="bi bi-chat-text"></i>
              Blog
            </a>
          </li>
        </ul>
      </div>



      {% for y in YEARS %}
      <h3 class="pub-year">
        {{ y }}
      </h3>

      {% for p in WORKS['publications'] %}
      {% if y == (p['date']|get_year) or (y == 'Before 2018' and (p['date']|get_year) not in YEARS) %}
      <div id="pub-{{ loop.index0 }}"
        class="row publication"
        pub_type="{{ p['type'] }}">
        <div class="pub-image column column-20">
          <img class="thumbnail lozad" 
            data-src="{{ page_name | pg2path }}/file/{{ p['thumb'] }}">
        </div>
        <div class="pub-content column column-80">
          <b class="pub-title">
            {{ p['title'] }}
          </b>
          <br>
          
          <span class="pub-authors">
            {{ p['authors'] | highlight_me }}
          </span>
          <br>

          <i>
            <span class="pub-source">{{ p['source'] }}</span>,
            {% if p['type'] == 'conference' %}
            <span class="pub-place">{{ p['place'] }}</span>,
            {% endif %}
            <span class="pub-date">{{ p['date'] }}</span>
          </i>
          <br>

          <span class="pub-links">
          {% for k in p['links'] %}
          <a href="{{ k[1] }}" 
            class="tag-link tag-link-{{ k[2] }}"
            data_type="{{ k[2] }}">
            {{ k[0] }}
          </a>
          {% endfor %}
          </span>
          
          <a target="_self"
            class="tag-link tag-link-cite tag-link-hover-show"
            title="cite this work"
            href="javascript:void(0);"
            onclick="cite_pub({{ loop.index0 }});">
            <i class="bi bi-quote"></i>
            Cite
          </a> 
          
          <br>
          <span class="text-smaller">&nbsp;</span>
        </div>
      </div>
      {% endif %}
      {% endfor %}
      {% endfor %}

      <p>&nbsp;</p>




      <h2 class="section-header" id="projects">
        Projects
      </h2>

      {% for p in WORKS['projects'] %}
      {% if p['title'] != '' %}
      <div class="row project">
        <div class="column column-20 col-date">
          {{ p['date'] }}
          <br>
          <img class="thumbnail lozad" 
            data-src="{{ page_name | pg2path }}/file/{{ p['thumb'] }}">
        </div>
        <div class="column column-80">
          <b>
            {{ p['title'] }}
          </b>
          <br>
          <i>
            {{ p['organization']}}, 
            {{ p['location'] }}
          </i>
          <br>

          {{ p['description']|md2html }}

          Links:
          {% for k in p['links'] %}
          <a href="{{ k[1] }}" class="tag-link tag-link-{{ k[2] }}">
            {{ k[0] }}
          </a> 
          {% endfor %}
        </div>
      </div>
      {% endif %}
      {% endfor %}



      

      <h2 class="section-header" id="tools">
        Tools
      </h2>

      <div class="row project" style="flex-wrap: wrap;">
        
        {% for p in WORKS['tools'] %}
        {% if p['slug'] != '' %}
        <div class="column column-25">
          <div class="tool-image">
            <img class="thumbnail lozad" 
              data-src="{{ page_name | pg2path }}/file/{{ p['thumb'] }}">
          </div>
          <b>
            {{ p['title'] }}
          </b>
          <br>
          {{ p['description'] }}
          <br>
          Link: 
          <a href="{{ p['homepage'] }}" 
            class="tag-link tag-link-demo">
            Homepage
          </a> |
          <a href="{{ p['repository'] }}" 
            class="tag-link tag-link-demo">
            Repository
          </a>
        </div>
        {% endif %}
        {% endfor %}

      </div>

      <p>&nbsp;</p>





      <h2 class="section-header" id="patents">
        Patents
      </h2>

      {% for p in WORKS['patents'] %}
      <div class="row patent">
        <div class="column column-20 col-date">
          {{ p['pid'] }}
          <br>
          {{ p['pid2'] }}
        </div>
        <div class="column column-80">
          <b>
            {{ p['title'] }}
          </b>
          <br>
          <span class="text-smaller">
            {{ p['subtitle'] }}
          </span><br>
          {{ p['authors']| highlight_me }}
        </div>
      </div>
      {% endfor %}

      <p>&nbsp;</p>



      <h2 class="section-header" id="work_exp">
        Work Experience
      </h2>
      

      {% for p in WORKS['work_exp'] %}
      <div class="row">
        <div class="work-date column column-20">
          {{ p['date_start'] }} 
          - 
          {{ p['date_end'] }}
        </div>
        <div class="column column-80">
          <b>
            {{ p['title'] }}
          </b>, 
          {{ p['organization'] }}
        </div>
      </div>
      {% endfor %}

      <p>&nbsp;</p>
      



      <h2 class="section-header" id="community_services">
        Community Services
      </h2>

      {% for p in WORKS['academic_exp'] %}
      <div class="row">
        <div class="column column-20">
          <b>
            {{ p['category'] }}
          </b>
        </div>
        <div class="column column-80">
          <ul>
            {% for i in p['items'] %}
            <li>
              {{ i }}
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
      {% endfor %}


      <h2 class="section-header" id="awards">
        Awards
      </h2>

      {% for p in WORKS['awards'] %}
      {% if p['title'] != '' %}
      <div class="row">
        <div class="column column-20 col-date">
          {{ p['date'] }}
        </div>
        <div class="column column-80">
          <b>
            {{ p['title'] }}
          </b>
          <br>
          {{ p['organization'] }},
          {{ p['location'] }}
        </div>
      </div>
      {% endif %}
      {% endfor %}

      <p>&nbsp;</p>

    </div>

  </div>

</div>

<div class="modal micromodal-slide" id="modal-citation" aria-hidden="true">
  <div class="modal__overlay" tabindex="-1" data-micromodal-close>
    <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-citation-title">
      <!-- <header class="modal__header">
        <h2 class="modal__title" id="modal-citation-title">
          Micromodal
        </h2>
        <button class="modal__close" aria-label="Close modal" data-micromodal-close></button>
      </header> -->
      <main class="modal__content" id="modal-citation-content">
        <div id="citation_content"
          class="citation-text">

        </div>
      </main>
      <footer class="modal__footer">
        
        <button class="modal__btn" 
          data-micromodal-close 
          aria-label="Close this dialog window">
          Close
        </button>
        |

        <button class="modal__btn modal__btn-primary"
          onclick="copy_cite_to_clipboard()">
          <i class="bi bi-clipboard-check"></i>
          Copy
        </button>

        <span id="modal_btn_msg">
        </span>

        <span>
          |
        </span>
        <span>
          Format: NLM
        </span>
      </footer>
    </div>
  </div>
</div>

</div>

<!-- Lazy Load -->
<script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>
<!-- Citation.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- dialog -->
<script src="https://unpkg.com/micromodal/dist/micromodal.min.js"></script>
<script>
MicroModal.init();

const Cite = require('citation-js');
// const csl = new Cite.CSL.Engine();
// csl.configure('https://raw.githubusercontent.com/citation-style-language/styles/master/vancouver.csl');

// console.log(csl);

function cite_pub(pub_idx) {
  // console.log("* cite_pub", pub_idx);

  // get title
  let type = document.querySelector('#pub-'+pub_idx).attributes['pub_type'].value;
  let title = document.querySelector('#pub-'+pub_idx+' .pub-title').innerText;
  let authors = document.querySelector('#pub-'+pub_idx+' .pub-authors').innerText;
  let source = document.querySelector('#pub-'+pub_idx+' .pub-source').innerText;
  let date = document.querySelector('#pub-'+pub_idx+' .pub-date').innerText;
  let links = _get_links_by_pub_idx(pub_idx);

  // other information
  let place = '';
  if (document.querySelector('#pub-'+pub_idx+' .pub-place') != null) {
    place = document.querySelector('#pub-'+pub_idx+' .pub-place').innerText;
  }

  // simple one
  let output = authors + ' "' + title + '." ' + source + ', ' + date;
  // copy_text_to_clipboard(output);

  // const ref = new Cite({
  //   title: title,
  //   year: get_year(date),
  //   author: authors_str_to_json_fmt(authors),
  //   journal: source,
  //   issued: {
  //     raw: date
  //   }
  // });

  // let str = ref.format('bibliography', {
  //   format: 'text', 
  //   template: 'vancouver', 
  //   lang: 'en-US', 
  //   append: '\n'
  // });

  // console.log('* ref:', str)
  // NLM format
  let str = authors_str_to_nlm_fmt(authors) + '. ' +
    title + ". " + 
    source + '. ' +
    (type == 'conference'? (place + ',') : '') +
    date + '. ' + 
    _get_ids_from_links(links);

  // update citation text
  document.querySelector('#citation_content').innerText = str;

  // show modal
  MicroModal.show('modal-citation');
}

function _get_links_by_pub_idx(pub_idx) {
  let tmps = document.querySelectorAll('#pub-' + pub_idx + ' .pub-links a');
  let links = [];
  for (let i = 0; i < tmps.length; i++) {
    const tmp = tmps[i];
    let data_type = tmp.getAttribute('data_type');
    let text = tmp.innerText.trim();
    let link = tmp.href;

    links.push({
      data_type: data_type,
      text: text,
      link: link
    });
  }
  return links;
}

function _get_ids_from_links(links) {
  var ret = [];
  for (let i = 0; i < links.length; i++) {
    const tmp = links[i];
    if (tmp.data_type == 'pmid') {
      ret.push('PMID: ' + tmp.text);
    } else if (tmp.data_type == 'pmcid') {
      ret.push('PMCID: ' + tmp.text);
    } else if (tmp.data_type == 'doi') {
      ret.push('doi: ' + tmp.text);
    } else {
      // pass
    }
  }
  return ret.join('. ');
}

function copy_cite_to_clipboard() {
  var cite_str = document.querySelector('#citation_content').innerText;
  copy_text_to_clipboard(cite_str);
  show_modal_btn_msg('Copied!');
}

function copy_text_to_clipboard(stringToCopy) {

    // Create a temporary textarea element to hold the string
    const textarea = document.createElement('textarea');
    textarea.value = stringToCopy;

    // Add the textarea element to the page
    document.body.appendChild(textarea);

    // Select the contents of the textarea
    textarea.select();

    // Copy the selected text to the clipboard
    document.execCommand('copy');

    // Remove the textarea from the page
    document.body.removeChild(textarea);
}

function show_modal_btn_msg(msg, flag_auto_hide) {
  if (typeof(flag_auto_hide)=='undefined') {
    flag_auto_hide = true;
  }
  document.querySelector('#modal_btn_msg').innerText = msg;
  if (flag_auto_hide) {
    setTimeout('clear_modal_btn_msg()', 3000);
  }
}

function clear_modal_btn_msg() {
  document.querySelector('#modal_btn_msg').innerText = '';
}

function get_year(dateStr) {
  const yearRegex = /(\d{4})/;
  const year = yearRegex.exec(dateStr)[1];
  return year;
}

function _authors_str_to_list(authors) {
  let ps = authors.split(',');
  let aus = [];
  for (let i = 0; i < ps.length; i++) {
    const p = ps[i];
    let p2 = p.trim();
    aus.push(p2);
  }
  return aus; 
}

function _get_first_chars_of_tokens(s) {
  let ps = s.split(' ');
  let cs = [];
  for (let i = 0; i < ps.length; i++) {
    const p = ps[i];
    cs.push(p.charAt(0));
  }
  return cs.join('').toLocaleUpperCase();
}

function _get_author_given_family_name(fullName) {
  const nameParts = fullName.split(' ');

  // Get the family name (last name) and given name (first name)
  const familyName = nameParts.pop();
  const givenName = nameParts.join(' ');
  return {
    "given": givenName,
    "family": familyName
  }
}

function authors_str_to_nlm_fmt(authors) {
  let aus = _authors_str_to_list(authors);
  let js = [];
  for (let i = 0; i < aus.length; i++) {
    const a = aus[i];
    let name = _get_author_given_family_name(a);
    js.push(name.family + ' ' + _get_first_chars_of_tokens(name.given));
  }
  return js.join(', ');
}

function authors_str_to_bibtex_fmt(authors) {
  let aus = _authors_str_to_list(authors);
  return aus.join(' and ');
}

function authors_str_to_json_fmt(authors) {
  let aus = _authors_str_to_list(authors);
  let js = [];
  for (let i = 0; i < aus.length; i++) {
    const a = aus[i];
    js.push(_get_author_given_family_name(a));
  }
  return js;
}
 
function backToTop() {
    document.querySelector('.wrapper').scrollTop = 0;
}

function toggleNavbar() {
    let navbar = document.querySelector('.navbar');
    if (navbar.classList.contains('display-block')) {
        navbar.classList.remove('display-block');
    } else {
        navbar.classList.add('display-block');
    }
}

function hideNavbar() {
    let navbar = document.querySelector('.navbar');
    navbar.classList.remove('display-block');
}

function onClickNav(obj) {
  console.log(obj);
  let navs = document.getElementsByClassName('nav-item');
  for (let i = 0; i < navs.length; i++) {
    navs[i].className = 'nav-item';
  }
  obj.parentNode.className = 'nav-item active';

  // hide the bar
  hideNavbar();
}

var navs = [];
var secs = [];

function activeNavs(nav_id) {
    navs.forEach((item) => {
        item.classList.remove('active');
    });
    document.querySelectorAll(`[href='#${nav_id}']`).forEach((item) => {
        item.parentElement.classList.add('active');
    });
}

function onClickContent() {
  let navbar = document.querySelector('.navbar');
    if (navbar.classList.contains('display-block')) {
        navbar.classList.remove('display-block');
    } else {
    }
}

function onScrollContent() {
    let scroll = document.querySelector('.wrapper').scrollTop;
    let active_idx = -1;

    if (scroll > 100) {
        document.querySelector('.back-to-top').classList.add('display-block');
    } else {
        document.querySelector('.back-to-top').classList.remove('display-block');
    }

    for (let i = 0; i < secs.length; i++) {
        let sec = secs[i];
        let offset = sec.offsetTop;
        let height = sec.offsetHeight;
        let id = sec.getAttribute('id');
        
        if (i == 0 && (scroll+300) < secs[i+1].offsetTop) {
            activeNavs(id);
            active_idx = 'first';
            break;

        } else if (i == (secs.length-1) && scroll > secs[i-1].offsetTop) {
            activeNavs(id);
            active_idx = 'last';
            break;

        } else if ((scroll+300) > offset && (scroll+300) < secs[i+1].offsetTop) {
            activeNavs(id);
            active_idx = i;
            break;

        } else {
            // nothing to do?
        }
    }
    
    // console.log(
    //     "* - " + scroll + " " + 
    //     '[ ' + 
    //     secs[0].offsetTop + ", " + 
    //     secs[1].offsetTop + ", " + 
    //     secs[2].offsetTop + ", " + 
    //     secs[3].offsetTop + ", " + 
    //     secs[4].offsetTop + ", " + 
    //     secs[5].offsetTop + ", " + 
    //     secs[6].offsetTop + " " +
    //     '] ' + 
    //     active_idx
    // );
};

window.onload = function() {
    // update navbar content
    document.querySelector('.navbar').innerHTML = document.querySelector('.navigation').innerHTML;

    // bind event
    document.querySelector('.wrapper').onscroll = onScrollContent;

    // bind event for click
    document.querySelector('.wrapper').onclick = onClickContent;

    // init variables
    navs = document.querySelectorAll('.nav-item');
    secs = document.querySelectorAll('.section-header');

    // lazy load
    const observer = lozad();
    observer.observe();
}
</script>
</body>
</html>
